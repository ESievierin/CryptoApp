<Page x:Class="CryptoApp.Presentation.Pages.CoinDetailPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Background="#121212"
      Foreground="White">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="30">

            <Button Content="← Back"
                    Command="{Binding GoBackCommand}"
                    Style="{StaticResource PrimaryButtonStyle}"
                    HorizontalAlignment="Left"
                    Margin="0,0,0,20"/>

            <Border Style="{StaticResource CardStyle}" Padding="20" Margin="0,0,0,20">
                <Grid VerticalAlignment="Center">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Image Source="{Binding Coin.Image}" 
                           Width="90" Height="90" 
                           Margin="0,0,20,0"/>

                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="0,0,20,0">
                        <TextBlock Text="{Binding Coin.Name}" FontSize="30" FontWeight="Bold"/>
                        <TextBlock Text="{Binding Coin.Symbol, Converter={StaticResource UpperCaseConverter}}" 
                                   FontSize="18" Foreground="Gray"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2" VerticalAlignment="Center" Margin="0,0,40,0">
                        <TextBlock Text="{Binding Coin.CurrentPrice, StringFormat={}{0:C}}"
                                   FontSize="36" FontWeight="Bold"/>
                        <TextBlock Text="{Binding Coin.PriceChangePercentage24h, StringFormat={}{0:F2}%}"
                                   Foreground="{Binding Coin.PriceChangePercentage24h, Converter={StaticResource ChangeToBrushConverter}}"
                                   FontSize="22" FontWeight="SemiBold"/>
                    </StackPanel>

                    <StackPanel Grid.Column="3" VerticalAlignment="Center">
                        <TextBlock Text="{Binding Coin.MarketCap, Converter={StaticResource MarketCapConverter}, StringFormat=Market Cap: {0}}" FontSize="20"/>
                        <TextBlock Text="{Binding Coin.FullyDilutedValuation, Converter={StaticResource MarketCapConverter}, StringFormat=FDV: {0}}" FontSize="20"/>
                    </StackPanel>

                    <StackPanel Grid.Column="4" VerticalAlignment="Center">
                        <TextBlock Text="{Binding Coin.TotalVolume, Converter={StaticResource MarketCapConverter}, StringFormat=Volume: {0}}" FontSize="20"/>
                    </StackPanel>

                    <StackPanel Grid.Column="5" VerticalAlignment="Center">
                        <TextBlock Text="{Binding Coin.Min24h, StringFormat=24h Low: {0:C}}" FontSize="20"/>
                        <TextBlock Text="{Binding Coin.Max24h, StringFormat=24h High: {0:C}}" FontSize="20"/>
                    </StackPanel>
                </Grid>
            </Border>
            
            <Border Style="{StaticResource CardStyle}" Padding="20">
                <StackPanel>
                    <TextBlock Text="Markets"
                               FontSize="26" FontWeight="Bold" Margin="0,0,0,20"
                               Foreground="#00E676"/>

                    <ItemsControl ItemsSource="{Binding Coin.Markets}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal" HorizontalAlignment="Center"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Style="{StaticResource CardStyle}"
                                        Width="220"
                                        Padding="15"
                                        Margin="10">
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="{Binding Exchange}"
                                                   FontSize="16" FontWeight="Bold"
                                                   Margin="0,0,0,5"
                                                   TextAlignment="Center"/>
                                        <TextBlock Text="{Binding Pair}"
                                                   FontSize="14"
                                                   Foreground="Gray"
                                                   Margin="0,0,0,10"
                                                   TextAlignment="Center"/>

                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <TextBlock Text="{Binding Price, StringFormat={}{0:F2}}"
                                                       FontSize="18" FontWeight="SemiBold"
                                                       Foreground="#00E676"
                                                       Margin="0,0,5,0"/>
                                            <TextBlock Text="{Binding Pair, Converter={StaticResource TargetCurrencyConverter}}"
                                                       FontSize="16" Foreground="Gray"/>
                                        </StackPanel>

                                        <Button Content="Open"
                                                Command="{Binding DataContext.OpenMarketCommand, RelativeSource={RelativeSource AncestorType=Page}}"
                                                CommandParameter="{Binding TradeUrl}"
                                                Style="{StaticResource PrimaryButtonStyle}"
                                                Margin="0,10,0,0"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>

        </StackPanel>
    </ScrollViewer>
</Page>
